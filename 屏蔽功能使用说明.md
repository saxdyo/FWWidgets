# TMDB屏蔽功能使用说明

## 功能概述

我已经成功为你的 `fw2.js` 脚本添加了完整的TMDB搜索屏蔽模块和屏蔽管理模块。这些功能可以让你：

- 按标题、类型、关键词、评分范围、年份范围屏蔽不需要的内容
- 管理屏蔽规则（添加、移除、清空）
- 查看屏蔽统计信息
- 测试屏蔽功能
- 导出/导入屏蔽配置

## 新增功能模块

### 1. 屏蔽管理系统 (TMDBBlockingManager)

**核心功能：**
- `getBlockingList()` - 获取当前屏蔽列表
- `addBlockingItem(type, value)` - 添加屏蔽项
- `removeBlockingItem(type, value)` - 移除屏蔽项
- `clearAllBlocking()` - 清空所有屏蔽
- `isItemBlocked(item)` - 检查项目是否被屏蔽
- `filterBlockedItems(items)` - 过滤屏蔽的项目

**支持的屏蔽类型：**
- `title` - 按标题屏蔽
- `genre` - 按类型屏蔽
- `keyword` - 按关键词屏蔽
- `rating` - 按评分范围屏蔽
- `year` - 按年份范围屏蔽

### 2. 新增的UI模块

在WidgetMetadata中添加了8个新的管理模块：

1. **TMDB 屏蔽管理** - 查看当前屏蔽列表
2. **添加屏蔽项** - 添加新的屏蔽规则
3. **移除屏蔽项** - 移除现有屏蔽规则
4. **清空所有屏蔽** - 清空所有屏蔽规则
5. **屏蔽统计信息** - 查看屏蔽规则统计
6. **测试屏蔽功能** - 测试屏蔽功能是否正常
7. **导出屏蔽配置** - 导出当前屏蔽配置
8. **导入屏蔽配置** - 导入屏蔽配置

## 使用方法

### 添加屏蔽规则

1. 选择"添加屏蔽项"模块
2. 选择屏蔽类型：
   - **标题**：输入要屏蔽的标题关键词
   - **类型**：输入TMDB类型ID（如：28=动作，16=动画）
   - **关键词**：输入要屏蔽的关键词
   - **评分范围**：输入JSON格式，如 `{"min": 0, "max": 5}`
   - **年份范围**：输入JSON格式，如 `{"min": 1990, "max": 2000}`

3. 输入屏蔽值
4. 执行模块

### 查看屏蔽列表

使用"TMDB 屏蔽管理"模块可以查看当前所有的屏蔽规则。

### 移除屏蔽规则

1. 选择"移除屏蔽项"模块
2. 选择要移除的屏蔽类型
3. 输入要移除的具体值（评分和年份范围可留空）
4. 执行模块

### 测试屏蔽功能

1. 选择"测试屏蔽功能"模块
2. 在测试数据字段输入JSON格式的测试数据
3. 执行模块查看屏蔽效果

## 屏蔽规则示例

### 标题屏蔽
```json
{
  "type": "title",
  "value": "复仇者联盟"
}
```

### 类型屏蔽
```json
{
  "type": "genre", 
  "value": "28"
}
```
（28 = 动作片）

### 关键词屏蔽
```json
{
  "type": "keyword",
  "value": "恐怖"
}
```

### 评分范围屏蔽
```json
{
  "type": "rating",
  "value": {"min": 0, "max": 5}
}
```

### 年份范围屏蔽
```json
{
  "type": "year",
  "value": {"min": 1990, "max": 2000}
}
```

## 集成到现有功能

屏蔽功能已经自动集成到以下主要加载函数中：

- `loadTmdbTrending()` - TMDB热门内容
- `loadTmdbTrendingWithAPI()` - TMDB API加载
- `loadTmdbTrendingFromPreprocessed()` - 预处理数据加载
- `loadImdbAnimeModule()` - IMDb动画模块

所有通过这些函数加载的内容都会自动应用屏蔽过滤。

## 配置选项

在CONFIG中可以配置：

```javascript
// 屏蔽系统配置
BLOCKING_ENABLED: true, // 启用屏蔽功能
BLOCKING_STORAGE_KEY: "tmdb_blocking_list", // 屏蔽列表存储键
```

## 数据存储

屏蔽规则使用 `Widget.preferences` 进行持久化存储，重启应用后规则仍然有效。

## 日志输出

屏蔽功能会输出详细的日志信息：

- `🚫 标题屏蔽: 电影名 包含 "关键词"`
- `🚫 类型屏蔽: 电影名 包含类型 "动作"`
- `🚫 关键词屏蔽: 电影名 包含关键词 "恐怖"`
- `🚫 评分屏蔽: 电影名 评分 3.5 超出范围 [6, 10]`
- `🚫 年份屏蔽: 电影名 年份 1995 超出范围 [2000, 2024]`
- `🚫 屏蔽过滤: 原始 20 项，屏蔽 3 项，剩余 17 项`

## 注意事项

1. 屏蔽功能默认启用，可以通过 `CONFIG.BLOCKING_ENABLED` 控制
2. 标题和关键词屏蔽使用包含匹配（不区分大小写）
3. 评分和年份屏蔽使用范围匹配
4. 屏蔽规则会应用到所有相关的数据加载函数
5. 缓存的数据也会应用屏蔽过滤

## 版本信息

- 脚本版本：2.1.0
- 屏蔽功能版本：1.0
- 兼容性：与现有功能完全兼容，不影响原有功能